%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% repost enviroment                            %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newtheoremstyle{myrepost}{}{}{}{}{\bfseries}{.\\}{1zw}{\thmname{\nameCref{\ImitationRef}}\hspace{0.2em}\getrefnumber{\ImitationRef}\thmnote{\hspace{0.5em}(#3)}}
\theoremstyle{myrepost}

\newcommand*{\ImitationRef}{initial}

\newtheorem*{_repost}{repost}
\NewDocumentEnvironment{repost}{r() o}{
  \renewcommand{\ImitationRef}{#1}
  \begin{_repost}[#2]
}{
  \end{_repost}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% selftitle enviroment                         %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newtheoremstyle{myselftitle}{}{}{}{}{\bfseries}{.\\}{1zw}{\ifthenelse{\NOT\equal{\SelfTitle}{??}}{\thmname{\SelfTitle}}{\thmname{#1}}\thmnote{\hspace{0.5em}(#3)}}
\theoremstyle{myselftitle}

\newcommand*{\SelfTitle}{??}

\newtheorem*{_selftitle}{selftitle}
\NewDocumentEnvironment{selftitle}{r() o}{
  \IfValueT{#1}{\renewcommand*{\SelfTitle}{#1}}
  \IfValueTF{#2}{\begin{_selftitle}[#2]}{\begin{_selftitle}}
}{
  \end{_selftitle}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% normal enviroments                           %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newtheoremstyle{mytheorem}{}{}{}{}{\bfseries}{.\\}{1zw}{\thmname{#1}\ifthenelse{\equal{\SelfNumber}{??}}{\thmnumber{\hspace{0.2em}#2}}{\hspace{0.2em}\SelfNumber}\thmnote{\hspace{0.5em}(#3)}}
\theoremstyle{mytheorem}

\newcommand*{\SelfNumber}{??}
\NewDocumentCommand\environment{m m}{
  \newtheorem{_#1}[BaseCounter]{#2}
  \newtheorem*{_#1*}{#2}
  \NewDocumentEnvironment{#1}{o}{
    \IfValueTF{##1}{\begin{_#1}[##1]}{\begin{_#1}}
  }{
    \end{_#1}
  }
  \NewDocumentEnvironment{#1*}{d() o}{
    \IfValueT{##1}{\renewcommand*{\SelfNumber}{##1}}
    \IfValueTF{##2}{\begin{_#1*}[##2]}{\begin{_#1*}}
  }{
    \end{_#1*}
  }
}

\NewDocumentCommand\LangCommon{}{
  \RenewDocumentEnvironment{proof}{d()}{
    \IfValueTF{##1}{\begin{_proof}[##1]}{\begin{_proof}}
  }{
    \qed\end{_proof}
  }
}

\NewDocumentCommand\English{}{
  \environment{definition}{Definition}
  \environment{theorem}{Theorem}
  \environment{proposition}{Proposition}
  \environment{lemma}{Lemma}
  \environment{corollary}{Corollary}
  \environment{problem}{Problem}

  \crefname{_definition}{definition}{definitions}
  \crefname{_theorem}{theorem}{theorems}
  \crefname{_proposition}{proposition}{propositions}
  \crefname{_lemma}{lemma}{lemmas}
  \crefname{_corollary}{corollary}{corollaries}
  \crefname{_problems}{problem}{problems}

  \newtheoremstyle{myproof}{}{}{}{}{\bfseries}{.}{0.5zw}{\thmname{##1}\thmnote{\hspace{0.2em}of\hspace{0.2em}\namecref{##3}\hspace{0.2em}\ref{##3}}}
  \theoremstyle{myproof}
  \newtheorem*{_proof}{Proof}
  \LangCommon
}

\NewDocumentCommand\Japanese{}{
  \environment{definition}{定義}
  \environment{theorem}{定理}
  \environment{proposition}{命題}
  \environment{lemma}{補題}
  \environment{corollary}{系}
  \environment{problem}{問題}

  \crefname{equation}{式}{式}

  \newtheoremstyle{myproof}{}{}{}{}{\bfseries}{.}{0.5zw}{\thmnote{\namecref{##3}\hspace{0.2em}\ref{##3}\hspace{0.2em}の}\thmname{##1}}
  \theoremstyle{myproof}
  \newtheorem*{_proof}{証明}
  \LangCommon
}
